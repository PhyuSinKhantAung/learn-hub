generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id                      Int                    @id @unique @default(autoincrement())
  name                    String?
  email                   String                 @unique
  role                    Role                   @default(STUDENT)
  isActive                Boolean                @default(true)
  createdAt               DateTime               @default(now())
  updatedAt               DateTime               @updatedAt
  password                String?
  googleId                String?                @unique
  assignmentSubmissions   AssignmentSubmission[]
  courseEnrollMents       CourseEnrollMent[]
  courseGrades            CourseGrade[]
  uploadedAssignmentFiles UploadedFile[]
}

model Course {
  id                Int                @id @unique @default(autoincrement())
  name              String
  courseDetails     String?
  courseEnrollMents CourseEnrollMent[]
  courseGrades      CourseGrade[]
  lessons           Lesson[]
}

model CourseEnrollMent {
  createdAt    DateTime       @default(now())
  updatedAt    DateTime       @updatedAt
  userId       Int
  courseId     Int
  role         CourseUserRole
  course       Course         @relation(fields: [courseId], references: [id])
  user         User           @relation(fields: [userId], references: [id])
  courseGrades CourseGrade[]

  @@id([userId, courseId])
  @@index([userId])
}

model CourseGrade {
  id               Int              @id @unique @default(autoincrement())
  userId           Int
  courseId         Int
  status           GradeStatus      @default(NORMAL)
  value            Int              @default(40)
  Course           Course           @relation(fields: [courseId], references: [id])
  courseEnrollment CourseEnrollMent @relation(fields: [userId, courseId], references: [userId, courseId])
  User             User             @relation(fields: [userId], references: [id])
}

model Lesson {
  id          Int       @id @unique @default(autoincrement())
  courseId    Int
  title       String
  description String?
  course      Course    @relation(fields: [courseId], references: [id])
  Episode     Episode[]
}

model Episode {
  id          Int            @id @unique @default(autoincrement())
  lessonId    Int
  title       String
  lesson      Lesson         @relation(fields: [lessonId], references: [id])
  resources   Resource[]
  files       UploadedFile[]
  assignments Assignment[]
}

model Assignment {
  id                    Int                    @id @unique @default(autoincrement())
  title                 String
  description           String
  episodeId             Int
  episode               Episode                @relation(fields: [episodeId], references: [id])
  assignmentSubmissions AssignmentSubmission[]
}

model AssignmentSubmission {
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  assignmentParagraph String
  graderBy            String?
  result              Int?
  isChecked           Boolean @default(false)

  assignmentId Int
  assignment   Assignment @relation(fields: [assignmentId], references: [id])

  userId          Int
  user            User           @relation(fields: [userId], references: [id])
  assignmentFiles UploadedFile[]

  @@id([userId, assignmentId])
}

model UploadedFile {
  name      String
  id        Int      @id @default(autoincrement())
  pathname  String   @unique
  episodeId Int?
  episode   Episode? @relation(fields: [episodeId], references: [id])
  type      FileType

  user   User? @relation(fields: [userId], references: [id])
  userId Int?

  assignmentSubmission             AssignmentSubmission? @relation(fields: [assignmentSubmissionUserId, assignmentSubmissionAssignmentId], references: [userId, assignmentId])
  assignmentSubmissionUserId       Int?
  assignmentSubmissionAssignmentId Int?
}

model Resource {
  id        Int     @id @unique @default(autoincrement())
  episodeId Int
  link      String
  episode   Episode @relation(fields: [episodeId], references: [id])
}

enum FileType {
  ASSIGNNMENT
  EPISODE
}

enum GradeStatus {
  NORMAL
  GOOD
  BAD
  EXCELLENT
}

enum CourseUserRole {
  STUDENT
  TEACHER
}

enum Role {
  STUDENT
  ADMIN
  TEACHER
  SUPERADMIN
}
